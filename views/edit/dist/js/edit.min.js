"use strict";var treeServer=axios.create({baseURL:window.location.origin+"/api/v1",timeout:1e3,headers:{"X-API-Access":localStorage.getItem("accessToken"),"X-API-Client":localStorage.getItem("clientToken")}}),app=new Vue({el:"#app",data:function(){return{trees:[],currentTree:void 0,errored:!1,loading:!0,elTypes:["question","end","start","group","option"],newEl:{question:{title:null},option:{questionID:null,title:null,destination:""},end:{title:null,content:null}},sort:{sorting:{elType:null,from:null,to:null,el:null},sortables:[],whitelist:["question","group","option"]}}},mounted:function(){this.reMount()},methods:{reMount:function(){var r=this;this.loading=!0;var o=window.scrollY;treeServer.get("/trees/"+tree.ID+"/compiled?stats=false").then(function(e){var t=e.data;if(r.trees.push(e.data),1===r.trees.length){var n=Object.assign({},t);r.trees.push(JSON.parse(JSON.stringify(n)))}r.currentTree=r.trees[r.trees.length-1]}).catch(function(e){console.error(e),r.errored=!0}).finally(function(){r.loading=!1,r.$nextTick(function(){for(var e=0;e<this.sort.whitelist.length;e++)this.setupSortable(this.sort.whitelist[e]);window.scrollTo(0,o);for(var t={},n=document.querySelectorAll("textarea"),r=0;r<n.length;r++)t.target=n[r],this.setTextareaHeight(t)})})},saveTree:function(){var t=this;treeServer.put("/trees/"+this.currentTree.ID,{title:this.currentTree.title,slug:this.currentTree.slug}).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),t.errored=!0})},saveElement:function(e,t){var n,r,o=this,s=void 0,i=void 0;i=(s=this.trees[this.trees.length-2][t+"s"])[this.getIndexBy(s,"ID",e)],r=this.buildSave(i),i=(s=this.currentTree[t+"s"])[this.getIndexBy(s,"ID",e)],n=this.buildSave(i),this.areObjectsEqual(n,r)?console.log("no changes"):treeServer.put("/trees/"+tree.ID+"/"+t+"s/"+e,n).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),o.errored=!0}).finally(function(){return o.reMount()})},deleteElement:function(e,t){var n=this;alert("Are you sure? This will delete the element."),treeServer.delete("/trees/"+tree.ID+"/"+t+"s/"+e).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),n.errored=!0}).finally(function(){return n.reMount()})},createElement:function(e){var t=this,n="/trees/"+tree.ID+"/"+e+"s";"option"===e&&(n="/trees/"+tree.ID+"/questions/"+this.newEl.option.questionID+"/options"),treeServer.post(n,this.newEl[e]).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),t.errored=!0}).finally(function(){t.newEl[e].title=null,t.newEl[e].content=null,t.newEl[e].questionID=null,t.newEl[e].destination=null,t.reMount()})},buildSave:function(e){for(var t={},n=["title","content","questionID","destination","questions"],r=0;r<n.length;r++)n[r]in e&&(t[n[r]]=e[n[r]]);return t},createOption:function(e){this.newEl.option.questionID=e,this.createElement("option")},setupSortable:function(r){var o=this,e="."+r+"s",t=document.querySelectorAll(e);if(0===t.length)return console.log("nothing found"),!1;this.sort.sortables[r]=new Sortable.default(t,{draggable:"."+r,appendTo:e,mirror:{constrainDimensions:!0}}),this.sort.sortables[r].on("drag:start",function(e){"DIV"!==document.activeElement.nodeName&&e.cancel(),o.sort.sorting.elType=r,o.sort.sorting.from=o.getElementIndex(e.data.source),o.sort.sorting.el=o.currentTree[r+"s"][o.sort.sorting.from]}),this.sort.sortables[r].on("drag:stop",function(e){o.sort.sorting.to=o.getElementIndex(e.data.source);var t=o.sort.sorting.to,n=o.sort.sorting.from;t!==n&&(n<t&&(t-=1),o.orderSave(r,o.sort.sorting.el,t)),o.sort.sorting.elType=null,o.sort.sorting.from=null,o.sort.sorting.to=null,o.sort.sorting.el=null})},orderSave:function(e,t,n){var r=this;treeServer.put("/trees/"+tree.ID+"/"+e+"s/"+t.ID+"/move/"+n).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),r.errored=!0}).finally(function(){return r.reMount()})},setTextareaHeight:function(e){e.target.style.height=e.target.scrollHeight+"px"},getElementIndex:function(e){for(var t=0;e=e.previousElementSibling;)t++;return t},getIndexBy:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r][t]==n)return r},areObjectsEqual:function(e,t){var n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!=r.length)return!1;for(var o=0;o<n.length;o++){var s=n[o];if(e[s]!==t[s])return!1}return!0}}});