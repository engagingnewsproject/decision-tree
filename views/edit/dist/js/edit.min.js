"use strict";var treeServer=axios.create({baseURL:window.location.origin+"/api/v1",timeout:1e3,headers:{"X-API-Access":localStorage.getItem("accessToken"),"X-API-Client":localStorage.getItem("clientToken")}}),app=new Vue({el:"#app",data:function(){return{trees:[],currentTree:void 0,errored:!1,loading:!0,elTypes:["question","end","start","group","option"],newEl:{title:null},sort:{sorting:{elType:null,from:null,to:null,el:null},sortables:[]}}},mounted:function(){this.reMount()},methods:{reMount:function(){var r=this;this.loading=!0;var o=window.scrollY;treeServer.get("/trees/"+tree.ID+"/compiled?stats=false").then(function(e){var t=e.data;if(r.trees.push(e.data),1===r.trees.length){var n=Object.assign({},t);r.trees.push(JSON.parse(JSON.stringify(n)))}r.currentTree=r.trees[r.trees.length-1]}).catch(function(e){console.log(e),r.errored=!0}).finally(function(){r.loading=!1,r.$nextTick(function(){this.setupSortable(),window.scrollTo(0,o);for(var e={},t=document.querySelectorAll("textarea"),n=0;n<t.length;n++)e.target=t[n],this.setTextareaHeight(e)})})},saveTree:function(){var t=this;treeServer.put("/trees/"+currentTree.ID,{title:this.currentTree.title,slug:this.currentTree.slug}).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),t.errored=!0})},saveElement:function(e,t){var n,r,o=this,s=void 0,l=void 0;l=(s=this.trees[this.trees.length-2][t+"s"])[this.getIndexBy(s,"ID",e)],r=this.buildSave(l),l=(s=this.currentTree[t+"s"])[this.getIndexBy(s,"ID",e)],n=this.buildSave(l),console.log(n),console.log(r),this.areObjectsEqual(n,r)?console.log("no changes"):(console.log("saving",n),treeServer.put("/trees/"+tree.ID+"/"+t+"s/"+e,n).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),o.errored=!0}).finally(function(){return o.reMount()}))},deleteElement:function(e,t){var n=this;alert("Are you sure? This will delete the element."),treeServer.delete("/trees/"+tree.ID+"/"+t+"s/"+e).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),n.errored=!0}).finally(function(){return n.reMount()})},createElement:function(e){var t=this;treeServer.post("/trees/"+tree.ID+"/"+e+"s",this.newEl).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),t.errored=!0}).finally(function(){t.newEl.title=null,t.reMount()})},buildSave:function(e){for(var t={},n=["title","content","questionID","destination","questions"],r=0;r<n.length;r++)n[r]in e&&(t[n[r]]=e[n[r]]);return t},setupSortable:function(){var r=this;console.log("setting up draggable");var e=".questions",t=document.querySelectorAll(e);if(console.log(t),0===t.length)return console.log("nothing found"),!1;this.sort.sortables.question=new Sortable.default(t,{draggable:".question",appendTo:e,mirror:{constrainDimensions:!0}}),this.sort.sortables.question.on("drag:start",function(e){"DIV"!==document.activeElement.nodeName&&e.cancel(),r.sort.sorting.elType="question",r.sort.sorting.from=r.getElementIndex(e.data.source),r.sort.sorting.el=r.currentTree.questions[r.sort.sorting.from]}),this.sort.sortables.question.on("drag:stop",function(e){r.sort.sorting.to=r.getElementIndex(e.data.source);var t=r.sort.sorting.to,n=r.sort.sorting.from;console.log(t),t!==n&&(n<t&&(t-=1),r.orderSave("question",r.sort.sorting.el,t)),r.sort.sorting.elType=null,r.sort.sorting.from=null,r.sort.sorting.to=null,r.sort.sorting.el=null})},getElementIndex:function(e){for(var t=0;e=e.previousElementSibling;)t++;return t},orderSave:function(e,t,n){var r=this;treeServer.put("/trees/"+tree.ID+"/"+e+"s/"+t.ID+"/move/"+n).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),r.errored=!0}).finally(function(){return r.reMount()})},setTextareaHeight:function(e){e.target.style.height=e.target.scrollHeight+"px"},getIndexBy:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r][t]==n)return r},areObjectsEqual:function(e,t){var n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!=r.length)return!1;for(var o=0;o<n.length;o++){var s=n[o];if(e[s]!==t[s])return!1}return!0}}});