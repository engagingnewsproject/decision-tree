"use strict";var treeServer=axios.create({baseURL:window.location.origin+"/api/v1",timeout:1e3,headers:{"X-API-Access":localStorage.getItem("accessToken"),"X-API-Client":localStorage.getItem("clientToken")}}),app=new Vue({el:"#app",data:function(){return{trees:[],currentTree:void 0,errored:!1,error:!1,loading:!0,elTypes:["question","end","start","group","option"],addOption:!1,newEl:{start:{title:null,destinationID:""},question:{title:null},option:{questionID:null,title:null,destinationID:""},end:{title:null,content:null},group:{title:null,content:null,questions:[]}},sort:{sorting:{elType:null,from:null,to:null,el:null},sortables:[],whitelist:["question"]},compiledResult:""}},mounted:function(){this.reMount()},methods:{reMount:function(){var o=this;this.loading=!0;var r=window.scrollY;treeServer.get("/trees/"+tree.ID+"/compiled?stats=false").then(function(e){var t=e.data;if(o.trees.push(e.data),1===o.trees.length){var n=Object.assign({},t);o.trees.push(JSON.parse(JSON.stringify(n)))}o.currentTree=o.trees[o.trees.length-1]}).catch(function(e){console.error(e),o.errored=!0,o.error=e}).finally(function(){o.loading=!1,o.$nextTick(function(){for(var e=0;e<this.sort.whitelist.length;e++)this.setupSortable(this.sort.whitelist[e]);window.scrollTo(0,r);for(var t={},n=document.querySelectorAll("textarea"),o=0;o<n.length;o++)t.target=n[o],this.setTextareaHeight(t)})})},saveTree:function(){var t=this;treeServer.put("/trees/"+this.currentTree.ID,{title:this.currentTree.title,slug:this.currentTree.slug}).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),t.errored=!0,t.error=e})},saveElement:function(e,t){var n,o,r=this,i=void 0,s=void 0,l=void 0,u=void 0;o=this.currentTree,s="option"!==t?(i=o[t+"s"])[this.getIndexBy(i,"ID",e)]:this.getOption(e,o),n=this.buildSave(s),console.log(n),l="/trees/"+o.ID+"/"+t+"s/"+e,"option"===t&&(u=this.getQuestionByOption(e),l="/trees/"+o.ID+"/questions/"+u.ID+"/options/"+e),treeServer.put(l,n).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),r.errored=!0,r.error=e}).finally(function(){return r.reMount()})},deleteElement:function(e,t){var n,o,r=this;alert("Are you sure? This will delete the "+t+"."),n="/trees/"+tree.ID+"/"+t+"s/"+e,"option"===t&&(o=this.getQuestionByOption(e),n="/trees/"+tree.ID+"/questions/"+o.ID+"/options/"+e),treeServer.delete(n).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),r.errored=!0,r.error=e}).finally(function(){return r.reMount()})},createElement:function(e){var t=this,n="/trees/"+tree.ID+"/"+e+"s";"option"===e&&(n="/trees/"+tree.ID+"/questions/"+this.newEl.option.questionID+"/options"),treeServer.post(n,this.newEl[e]).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),t.errored=!0,t.error=e}).finally(function(){t.newEl[e].title=null,t.newEl[e].content=null,t.newEl[e].questionID=null,t.newEl[e].destinationID=null,t.reMount()})},buildSave:function(e){for(var t={},n=["title","content","questionID","destinationID","questions"],o=0;o<n.length;o++)n[o]in e&&(t[n[o]]=e[n[o]],"destinationID"===n[o]&&(t.destinationType=this.getDestinationTypeByID(e[n[o]]),console.log("finding destination of ",e[n[o]]),console.log("destinationType",t.destinationType)));return t},createOption:function(e){this.newEl.option.questionID=e,this.createElement("option"),this.toggleAddOption()},setupSortable:function(o){var r=this,e="."+o+"s",t=document.querySelectorAll(e);if(0===t.length)return console.log("no sortable found for "+o),!1;this.sort.sortables[o]=new Sortable.default(t,{draggable:"."+o,appendTo:e,mirror:{constrainDimensions:!0}}),this.sort.sortables[o].on("drag:start",function(e){"DIV"!==document.activeElement.nodeName&&e.cancel(),r.sort.sorting.elType=o,r.sort.sorting.from=r.getElementIndex(e.data.source),r.sort.sorting.el=r.currentTree[o+"s"][r.sort.sorting.from]}),this.sort.sortables[o].on("drag:stop",function(e){r.sort.sorting.to=r.getElementIndex(e.data.source);var t=r.sort.sorting.to,n=r.sort.sorting.from;t!==n&&(n<t&&(t-=1),r.orderSave(o,r.sort.sorting.el,t)),r.sort.sorting.elType=null,r.sort.sorting.from=null,r.sort.sorting.to=null,r.sort.sorting.el=null})},orderSave:function(e,t,n){var o=this,r="/trees/"+tree.ID+"/"+e+"s/"+t.ID+"/move/"+n;if("option"===e){var i=this.getQuestionByOption(t.ID);r="/trees/"+tree.ID+"/questions/"+i.ID+"/options/"+t.ID+"/move/"+n}treeServer.put(r).then(function(e){return console.log(e.data)}).catch(function(e){console.log(e),o.errored=!0,o.error=e}).finally(function(){return o.reMount()})},compile:function(){var t=this;treeServer.post("/trees/"+tree.ID+"/compiled").then(function(e){console.log(e.data),t.compiledResult=e.data}).catch(function(e){console.log(e),t.errored=!0,t.error=e}).finally(function(){return t.reMount()})},setTextareaHeight:function(e){e.target.style.height=e.target.scrollHeight+"px"},toggleAddOption:function(e){this.addOption=e},getElementIndex:function(e){for(var t=0;e=e.previousElementSibling;)t++;return t},getOption:function(e,t){void 0===t&&(t=this.currentTree);var n,o=void 0;n=t.questions;for(var r=0;r<n.length;r++)if(void 0!==(o=this.getIndexBy(n[r].options,"ID",e)))return n[r].options[o]},getQuestionByOption:function(e){var t;t=this.currentTree.questions;for(var n=0;n<t.length;n++)if(void 0!==this.getIndexBy(t[n].options,"ID",e))return t[n]},getDestinationTypeByID:function(e){var t,n;t=this.currentTree.questions;for(var o=0;o<t.length;o++)if(t[o].ID===e)return"question";n=this.currentTree.ends;for(var r=0;r<n.length;r++)if(n[r].ID===e)return"end"},getIndexBy:function(e,t,n){for(var o=0;o<e.length;o++)if(e[o][t]==n)return o},areObjectsEqual:function(e,t){var n=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(t);if(n.length!=o.length)return!1;for(var r=0;r<n.length;r++){var i=n[r];if(e[i]!==t[i])return!1}return!0}}});