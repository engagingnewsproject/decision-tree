function TreeView(e){var t,i,n,s,o,r,a;if("object"!=typeof e.container)return console.error("Tree container must be a valid object. Try `container: document.getElementById(your-id)`."),!1;this.getContainer=function(){return i},this.getTree=function(){return t},this.getTreeEl=function(){return n},this.getActiveEl=function(){return r},this.getContentWindow=function(){return s},this.getContentPane=function(){return o},this.getCSSPriority=function(){return a},this.setTree=function(e){return void 0===t&&(t=e),t},this.setTreeEl=function(){return void 0===n&&(n=i.firstElementChild),n},this.setContentWindow=function(){return void 0===s&&(s=document.getElementById("cme-tree__content-window--"+t.getTreeID())),s},this.setContentPane=function(){return void 0===o&&(o=s.firstElementChild),o},this.setCSSPriority=function(e){return a=void 0!==a||"important"!==e&&"!important"!==e?"":"!important"},this.setActiveEl=function(e){let t,i;return i="overview"===e.type?"cme-tree--"+e.id:"cme-tree__el--"+e.id,void 0!==r&&r.id===i?r:(t=document.getElementById(i),"object"!=typeof t?(console.error("Could not set active element for state type "+e.type+" with state id "+e.id),!1):r=t)},this.activeClassName="is-active",this.animationLength=500,this.scaledSize=.65,this.stylesheet=this.createStylesheet(),this.windowWidth=window.innerWidth,i=e.container,this.setCSSPriority(e.cssPriority),i.addEventListener("click",this.click.bind(this)),i.addEventListener("keydown",this.keydown.bind(this)),this.resizeTimeout=null,window.addEventListener("resize",this.resize.bind(this)),e.Tree&&this.build(e.Tree)}TreeView.prototype={constructor:TreeView,on:function(e,t){switch(e){case"ready":this.build(t);break;case"update":this.updateState(t);break;case"getTreeHeight":this.emit("treeHeight","treeHeight",{treeHeight:this.getTreeHeight()})}},build:function(e){this.setTree(e),this.render(e.getData()),this.setContentWindow(),this.setContentPane(),this.emit("ready","viewReady",this);this.setState(e.getState(),!0),this.updateViewHeight(e.getState()),this.checkForGroupsCalc()},render:function(e){var t=(0,window.TreeTemplates.tree)(e);this.getContainer().innerHTML=t,this.setTreeEl(),this.bindAllData()},getGroups:function(){let e;return e=this.getTreeEl(),e.getElementsByClassName("cme-tree__group")},getQuestions:function(){let e;return e=this.getTreeEl(),e.getElementsByClassName("cme-tree__question")},getQuestion:function(e){return this.getDestination(e)},getEnds:function(){let e;return e=this.getTreeEl(),e.getElementsByClassName("cme-tree__end")},getEnd:function(e){return this.getDestination(e)},getDestination:function(e){return document.getElementById("cme-tree__el--"+e)},getOptions:function(e){return e.getElementsByClassName("cme-tree__option-link")},getDestinationIcon:function(e){return document.getElementById("cme-tree__destination-icon--"+e)},getStylesheet:function(){return this.stylesheet},createStylesheet:function(){let e;return e=document.createElement("style"),e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet},getTreeHeight:function(){return this.getAbsoluteBoundingRect(this.getContainer()).height},updateState:function(e){let t,i,n,s;t=e.oldState,i=e.newState,n=this.getActiveEl(),t.type!==i.type&&this.removeContainerState(t),t.id!==i.id&&(n.classList.remove(this.activeClassName),n.classList.add("cme-tree__"+t.type+"--animate-out"),setTimeout(()=>{n.classList.remove("cme-tree__"+t.type+"--animate-out")},this.animationLength)),s=this.setState(e.newState),"overview"===t.type||"overview"===i.type?setTimeout(()=>{this.updateViewHeight(i)},this.animationLength):this.updateViewHeight(i),this.updateFocusable(t,i),!1===s&&(this.setState(t),this.updateViewHeight(t))},setState:function(e,t){let i;return this.addContainerState(e),i=this.setActiveEl(e),!1!==i&&(i.classList.add(this.activeClassName),!0!==t?window.setTimeout(()=>{i.focus()},this.animationLength):"overview"!==e.type&&this.removeAllFocusable(),!0)},calculateQuestionsSize:function(){let e;e=this.getQuestions();for(let t=0;t<e.length;t++)e[t].data.bounds={offsetHeight:e[t].offsetHeight,offsetTop:e[t].offsetTop}},calculateEndsSize:function(){let e;e=this.getEnds();for(let t=0;t<e.length;t++)e[t].data.bounds={offsetHeight:e[t].offsetHeight,offsetTop:e[t].offsetTop}},checkEndPositionAccuracy:function(){let e,t,i=!1;return e=this.getEnds(),t=e[e.length-1],void 0!==t.data.bounds&&t.data.bounds.offsetHeight===t.offsetHeight&&t.data.bounds.offsetTop===t.offsetTop&&(i=!0),i},updateViewHeight:function(e){let t,i,n,s,o,r,a;t=this.getActiveEl(),i=this.getContentPane(),n=this.getContentWindow(),"question"===e.type||"end"===e.type?(void 0===t.data.bounds&&(this.calculateQuestionsSize(),this.calculateEndsSize()),r=-t.data.bounds.offsetTop,o="translate3d(0,"+r+"px,0)",s=t.data.bounds.offsetHeight,setTimeout(()=>{console.log("resize check"),!0!==this.checkEndPositionAccuracy()&&this.resize(!0)},200),setTimeout(()=>{n.scrollTop=0},this.animationLength+100)):"intro"===e.type?this.checkForGroupsCalc():"overview"===e.type?(this.checkForGroupsCalc(),a=this.getGroupsHeight(),this.displayArrowDirection(),s=i.getBoundingClientRect().height,s<a&&(s=a),o=""):o="",n.setAttribute("style","height: "+s+"px"+this.getCSSPriority()+";"),this.setTransform(i,o),this.emit("viewChange","viewHeightUpdate",{cWindowHeight:s,questionOffsetTop:r})},addContainerState:function(e){let t=this.getTreeEl().classList;t.contains("cme-tree__state--"+e.type)||t.add("cme-tree__state--"+e.type)},removeContainerState:function(e){let t=this.getTreeEl();t.classList.remove("cme-tree__state--"+e.type),t.classList.add("cme-tree__state--animate-out--"+e.type),window.setTimeout(()=>{t.classList.remove("cme-tree__state--animate-out--"+e.type)},this.animationLength)},keydown:function(e){13!==e.keyCode&&32!==e.keyCode||this.click(e,{updatedBy:"keypress",observer:"TreeView"})},updateFocusable:function(e,t){let i,n;"intro"!==t.type&&"overview"!==e.type||this.removeAllFocusable(),"question"!==e.type&&"end"!==e.type||(i=this.getDestination(e.id),this.removeFocusable(i)),"overview"===t.type&&this.addAllFocusable(),"question"!==t.type&&"end"!==t.type||(n=this.getDestination(t.id),this.addFocusable(n))},removeFocusable:function(e){let t;t=e.querySelectorAll("a");for(let e=0;e<t.length;e++)t[e].tabIndex=-1},addFocusable:function(e){let t;t=e.querySelectorAll("a");for(let e=0;e<t.length;e++)t[e].tabIndex=0},addAllFocusable:function(){let e;e=document.querySelectorAll(".cme-tree__question, .cme-tree__end");for(let t=0;t<e.length;t++)this.addFocusable(e[t])},removeAllFocusable:function(){let e;e=document.querySelectorAll(".cme-tree__question, .cme-tree__end");for(let t=0;t<e.length;t++)this.removeFocusable(e[t])},click:function(e,t){let i;if(void 0===t&&(t={updatedBy:"click",observer:"TreeView"}),i=e.target,i!==e.currentTarget)if("A"!==i.nodeName&&(i=this.findAncestor(i,"A")),"A"===i.nodeName&&void 0!==i.data)if("overview"!==this.getTree().getState().type||"overview"===this.getTree().getState().type&&"start"===i.data.type)e.preventDefault(),this.emit("update","state",Object.assign(i.data,t));else{e.preventDefault(),this.getDestination(i.data.destinationID).focus(),this.emit("overviewOptionInteraction","overviewOptionInteraction",i.data)}else"SECTION"===i.nodeName&&e.preventDefault();e.stopPropagation()},resize:function(e){if(!0!==e&&this.windowWidth===window.innerWidth)return!1;this.resizeTimeout=null,this.resizeTimeout||(this.resizeTimeout=setTimeout(()=>{this.calculateQuestionsSize(),this.calculateEndsSize(),this.calculateGroups(),this.updateViewHeight(this.getTree().getState()),this.windowWidth=window.innerWidth},450))},emit:function(e,t,i){let n=this.getTree();switch(e){case"update":n.update(t,i);break;case"ready":case"viewChange":case"treeHeight":case"overviewOptionInteraction":n.message(t,i)}},bindAllData:function(){let e=this.getTree(),t=["question","start","end","group"],i=this.getTreeEl();i.hasOwnProperty("data")||(i.data={});for(let i=0;i<t.length;i++){let o=e.getDataByType(t[i]);for(let e=0;e<o.length;e++){let r=o[e].ID,a=document.getElementById("cme-tree__el--"+r);switch(this.bindDOMData(o[e],a,t[i]),t[i]){case"question":let t=o[e].options;for(let e=0;e<t.length;e++){let i=document.getElementById("cme-tree__el--"+t[e].ID);this.bindDOMData(t[e],i,"option")}break;case"end":var n=document.getElementById("cme-tree__restart--"+r);this.bindDOMData(o[e],n,"restart");var s=document.getElementById("cme-tree__overview--"+r);this.bindDOMData(o[e],s,"overview")}}}},bindDOMData:function(e,t,i){if(void 0===t.data){let n;switch(i){case"start":n={ID:e.ID,type:"start"};break;case"group":n={ID:e.ID,type:"group",order:e.order};break;case"question":n={ID:e.ID,type:"question",order:e.order,groupID:this.getTree().getGroupIDByQuestion(e.ID)},n.options=[];for(let t=0;t<e.options.length;t++)n.options.push(e.options[t].ID);break;case"option":n={ID:e.ID,type:"option",order:e.order,destinationID:e.destinationID,destinationType:e.destinationType};break;case"end":n={ID:e.ID,type:"end",order:e.order};break;case"restart":n={ID:e.ID,type:"restart"};break;case"overview":n={overviewID:e.ID,type:"overview"}}return t.data=n,t.data}return!1},getAbsoluteBoundingRect:function(e){var t=document,i=window,n=t.body,s=void 0!==i.pageXOffset?i.pageXOffset:(t.documentElement||n.parentNode||n).scrollLeft,o=void 0!==i.pageYOffset?i.pageYOffset:(t.documentElement||n.parentNode||n).scrollTop,r=e.getBoundingClientRect();if(e!==n)for(var a=e.parentNode;a!==n;)s+=a.scrollLeft,o+=a.scrollTop,a=a.parentNode;return{bottom:r.bottom+o,height:r.height,left:r.left+s,right:r.right+s,top:r.top+o,width:r.width}},calculateGroups:function(){let e;e=this.getGroups();for(let t=0;t<e.length;t++)e[t].data.size={width:e[t].offsetWidth,height:e[t].offsetHeight};this.calculateGroupsSize(),this.addGroupStyles()},addGroupStyles:function(){let e,t,i,n;e=this.getGroups(),i=this.getTreeEl(),t=i.data.groupsOffsetLeft,n=this.getCSSPriority();for(let i=0;i<e.length;i++)this.addStylesheetRule(".cme-tree__state--overview #"+e[i].id+", .cme-tree__state--intro #"+e[i].id,[["transform","translate3d("+t+"px,"+e[i].data.offsetTop+"px, 0)"+n]])},addStylesheetRule:function(e,t){let i,n;n=null,i=this.getStylesheet();for(let t=0;t<i.cssRules.length;t++)if(i.cssRules[t].selectorText===e){n=t;break}null===n&&(n=i.cssRules.length,i.insertRule(e+"{"+t[0][0]+": "+t[0][1]+"}",n));for(let e=0;e<t.length;e++)i.cssRules[n].style[t[e][0]]=t[e][1]},checkForGroupsCalc:function(){void 0===this.getGroups()[0].data.size&&this.calculateGroups()},calculateGroupsSize:function(){let e,t,i,n,s,o;e=this.getGroups(),n=0;for(let o=0;o<e.length;o++)t=e[o].data.size,0===o&&(s=t.width*this.scaledSize,i=s<350?1.5*s+30:1.5*s+50),e[o].data.offsetTop=n,n=n+t.height+110;return o=this.getTreeEl(),o.data.groupsOffsetLeft=i,o.data.groupsHeight=n,n},getGroupsHeight:function(){let e;return e=this.getTreeEl(),e.data.hasOwnProperty("groupsHeight")||this.calculateGroupsSize(),e.data.groupsHeight},lineAngle:function(e,t){let i;return i=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI,-1===Math.sign(i)&&(i+=360),i},displayArrowDirection:function(){let e,t,i,n,s,o,r,a,l,h;e=this.getQuestions();for(let d=0;d<e.length;d++){s=this.getOptions(e[d]);for(let u=0;u<s.length;u++)if("question"===s[u].data.destinationType){if(t=this.getDestination(s[u].data.destinationID),e[d].data.groupID===t.data.groupID)continue;o=this.getDestinationIcon(s[u].data.ID),r=this.getAbsoluteBoundingRect(o),i=this.getAbsoluteBoundingRect(t),l={y:r.top+r.height/2},n={y:i.top+i.height/2},l.x=r.left+r.width/2,n.x=i.left+i.width/2,a=this.lineAngle(l,n),h=360-a,80<h&&h<90?this.templateArrowUpRight(o):90<h&&h<100?this.templateArrowUpLeft(o):h<10||350<h?(this.templateArrow(o,"arrow"),this.setTransform(o,"rotate(180deg)")):170<h&&h<190?(this.templateArrow(o,"arrow"),this.setTransform(o,"rotate(-180deg)")):270<h&&h<280?this.templateArrowDownRight(o):260<h&&h<270?this.templateArrowDownLeft(o):(this.templateArrow(o,"arrow"),this.setTransform(o,"rotate("+a+"deg)"))}}},templateArrowUpRight(e){this.templateArrow(e,"arrow-turn"),this.setTransform(e,"rotateX(-180deg)")},templateArrowUpLeft(e){this.templateArrow(e,"arrow-turn"),this.setTransform(e,"rotateX(180deg)")},templateArrowDownRight(e){this.templateArrow(e,"arrow-turn"),this.setTransform(e,"rotateX(0deg)")},templateArrowDownLeft(e){this.templateArrow(e,"arrow-turn"),this.setTransform(e,"rotateX(-180deg)")},templateArrow:(e,t)=>(e.childNodes[0].setAttribute("xlink:href","#icon-"+t),e),findAncestor(e,t){let i=0;for(;e.nodeName!=t&&i<4;)e=e.parentElement,i++;return e},setTransform:function(e,t){e.setAttribute("style","transform: "+t+this.getCSSPriority()+";")}};