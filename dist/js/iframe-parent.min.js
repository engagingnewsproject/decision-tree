"use strict";var cmeTreeIframes=[];function handleCmeIframeMessage(e){var t,r,a,n,s,i,o;if(t=window.location.href,!/https?:\/\/(?:dev|localhost:3000|tree\.mediaengagement\.org|(?:enptree|cmetree)(\.staging)?\.wpengine\.com)\b/.test(e.origin))return console.error("Domain not allowed.",e.origin),!1;if("string"!=typeof e.data)return console.error("Data is not a string."),!1;if(n="cme-tree__"+(a=JSON.parse(e.data)).treeID,r={iframe:s=document.getElementById(n),parentURL:t,treeID:a.treeID},0===cmeTreeIframes.length)cmeTreeIframes.push(new CmeIframeTree(r)),i=cmeTreeIframes[0];else{o=!1;for(var m=0;m<cmeTreeIframes.length;m++)cmeTreeIframes[m].iframeID===s.id&&(i=cmeTreeIframes[m],o=!0);!1===o&&(cmeTreeIframes.push(new CmeIframeTree(r)),i=cmeTreeIframes[cmeTreeIframes.length-1])}i.receiveIframeMessage(e.origin,a)}function CmeIframeTree(e){this.iframe=e.iframe,this.iframeID=e.iframe.id,this.treeID=e.treeID,this.onLoadIframe()}window.addEventListener("message",handleCmeIframeMessage,!1),document.onreadystatechange=function(){var e=void 0,t=void 0;if("complete"===document.readyState){e=document.getElementsByClassName("cme-tree__iframe");for(var r=0;r<e.length;++r)t='{"status":"request","action":"init"}',console.log("sending init",t),e[r].contentWindow.postMessage(t,e[r].src)}},CmeIframeTree.prototype={constructor:CmeIframeTree,getSiteName:function(){var e=this.getFBSiteNameMeta();return e=e?"":document.title},getFBSiteNameMeta:function(){var e=document.querySelector('meta[property="og:site_name"]');return!!e&&e.content},receiveIframeMessage:function(e,t){var r;return r={},console.log("parent recieved message",t),"treeHeight"===t.action?r.setTreeHeight=this.setTreeHeight(t.treeHeight):"update"===t.action&&"forceCurrentState"!==t.data.updatedBy?r.scrollToQuizResponse=this.scrollToQuiz():"getParentSiteName"===t.action?this.sendSiteName():"getParentPath"===t.action?this.sendPath():"getParentHost"===t.action&&this.sendHost(),r},onLoadIframe:function(){this.addIframeStyles(),this.getQuizHeight(),this.sendHost(),this.sendPath()},getQuizHeight:function(){this.iframe.contentWindow.postMessage('{"status":"request","action":"sendBodyHeight"}',this.iframe.src)},sendSiteName:function(){var e;e='{"action":"setParentSiteName","siteName":"'+this.getSiteName()+'"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},sendPath:function(){var e;e='{"action":"setParentPath","path":"'+window.self.location.pathname+'"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},sendHost:function(){var e;e='{"action":"setParentHost","host":"'+window.self.location.host+'"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},setTreeHeight:function(e){return console.log(e),this.iframe.style.height=e+"px",e},scrollToQuiz:function(){var e=!1,t=this.iframe.getBoundingClientRect().top;return-20<t&&t<100?e="noScroll":(scrollBy(0,t-10),e="scrolledTop"),e},addIframeStyles:function(){var e=".cme-tree__iframe { -webkit-transition: all .3s ease-in-out;transition: all .3s ease-in-out; }",t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)}};